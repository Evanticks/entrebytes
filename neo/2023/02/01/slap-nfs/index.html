<!DOCTYPE html><html class="appearance-auto" lang="en"><head><meta charset="UTF-8"><title>Directorios centralizados con LDAP y NFS</title><meta name="description" content="Aprendiz de Informática"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><!-- End Google Analytics -->
<!-- Baidu Analytics --><!-- End Baidu Analytics --><link rel="icon" href="/images/favicon.png"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="
# Directorios centralizados con LDAP y NFS
# Introducción
En este post vamos a ver como crear un directorio centralizado con LDAP y NFS.
# Instalación de LDAP
Para instalar LDAP vamos a usar el paquete slapd, que es el servidor LDAP.
apt install slapdUna vez instalado vamos a configurarlo, para ello ejecutamos el comando:
dpkg-reconfigure slap-utilsNos pe.."><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
</head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">El blog de Antonio Marchán</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">Directorios centralizados con LDAP y NFS</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">Volver arriba</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">Inicio</a></h3><h3 class="is-inline-block"><a href="/about">Sobre mí</a></h3><h3 class="is-inline-block"><a href="/archives">Archivos</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">Inicio</a></h3><h3 class="is-inline-block"><a href="/about">Sobre mí</a></h3><h3 class="is-inline-block"><a href="/archives">Archivos</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#directorios-centralizados-con-ldap-y-nfs"><span class="toc-text"> Directorios centralizados con LDAP y NFS</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#introducci%C3%B3n"><span class="toc-text"> Introducción</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#instalaci%C3%B3n-de-ldap"><span class="toc-text"> Instalación de LDAP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cliente-ubuntu"><span class="toc-text"> Cliente Ubuntu</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cliente-rocky-linux"><span class="toc-text"> Cliente Rocky Linux</span></a></li></ol></li></ol></div><div class="column is-9"><header class="my-4"></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">Directorios centralizados con LDAP y NFS</h1><time class="has-text-grey" datetime="2023-01-31T23:48:29.644Z">2023-02-01</time><article class="mt-2 post-content"><p><img src="/images/LOGO-LDAP.png" alt="Descripción de la imagen"></p>
<h1 id="directorios-centralizados-con-ldap-y-nfs"><a class="markdownIt-Anchor" href="#directorios-centralizados-con-ldap-y-nfs">#</a> Directorios centralizados con LDAP y NFS</h1>
<h2 id="introducción"><a class="markdownIt-Anchor" href="#introducción">#</a> Introducción</h2>
<p>En este post vamos a ver como crear un directorio centralizado con LDAP y NFS.</p>
<h2 id="instalación-de-ldap"><a class="markdownIt-Anchor" href="#instalación-de-ldap">#</a> Instalación de LDAP</h2>
<p>Para instalar LDAP vamos a usar el paquete slapd, que es el servidor LDAP.</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">apt</span> <span class="token function">install</span> slapd</pre></td></tr></table></figure><p>Una vez instalado vamos a configurarlo, para ello ejecutamos el comando:</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>dpkg-reconfigure slap-utils</pre></td></tr></table></figure><p>Nos pedirá que introduzcamos la contraseña de del usuario root del servidor slapd, y nos preguntará si queremos usar el dominio de la máquina o no, en este caso vamos a usar el dominio de la máquina.</p>
<p>Con el siguiente comando podremos ver la información del usuario root en el dominio <a target="_blank" rel="noopener" href="http://gonzanonazareno.org">gonzanonazareno.org</a></p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>ldapsearch <span class="token parameter variable">-x</span> <span class="token parameter variable">-D</span> <span class="token string">"cn=admin,dc=antonio,dc=gonzalonazareno,dc=org"</span> <span class="token parameter variable">-b</span> <span class="token string">"dc=antonio,dc=gonzalonazareno,dc=org"</span> <span class="token parameter variable">-W</span></pre></td></tr></table></figure><p><img src="/images/slap1-1.png" alt="Descripción de la imagen"></p>
<p>Ahora crearemos una unidad organizativa, en este caso la llamaremos Organizacion.ldif, y le daremos el siguiente contenido:</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>dn: <span class="token assign-left variable">ou</span><span class="token operator">=</span>Personas,dc<span class="token operator">=</span>antonio,dc<span class="token operator">=</span>gonzalonazareno,dc<span class="token operator">=</span>org</pre></td></tr><tr><td data-num="2"></td><td><pre>objectClass: organizationalUnit</pre></td></tr><tr><td data-num="3"></td><td><pre>ou: Personas</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>dn: <span class="token assign-left variable">ou</span><span class="token operator">=</span>Grupos,dc<span class="token operator">=</span>antonio,dc<span class="token operator">=</span>gonzalonazareno,dc<span class="token operator">=</span>org</pre></td></tr><tr><td data-num="6"></td><td><pre>objectClass: organizationalUnit</pre></td></tr><tr><td data-num="7"></td><td><pre>ou: Grupos</pre></td></tr></table></figure><p>“dn” significa Distinguished Name, e indica el nombre distintivo que el objeto tendrá dentro de la jerarquía de directorios, y “objectClass” es la clase de objeto, en este caso es una unidad organizativa.</p>
<p>Procedemos a ejecutar el siguiente comando para inyectar los nuevos objetos en el árbol de slapd:</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>ldapadd <span class="token parameter variable">-x</span> <span class="token parameter variable">-D</span> <span class="token string">"cn=admin,dc=antonio,dc=gonzalonazareno,dc=org"</span> <span class="token parameter variable">-f</span> UnidadesOrganizativas.ldif <span class="token parameter variable">-W</span></pre></td></tr></table></figure><p><img src="/images/slap1-2.png" alt="Descripción de la imagen"></p>
<p>Ahora si volvemos a ejecutar el comando</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>ldapsearch <span class="token parameter variable">-x</span> <span class="token parameter variable">-D</span> <span class="token string">"cn=admin,dc=antonio,dc=gonzalonazareno,dc=org"</span> <span class="token parameter variable">-b</span> <span class="token string">"dc=antonio,dc=gonzalonazareno,dc=org"</span> <span class="token parameter variable">-W</span></pre></td></tr></table></figure><p>Podremos ver que se han creado los nuevos objetos llamados Personas y Grupos.</p>
<p><img src="/images/slap1-3.png" alt="Descripción de la imagen"></p>
<p>Ahora vamos a crear un usuario, para ello crearemos un fichero llamado usuarios.ldif, y le daremos el siguiente contenido:</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>dn: <span class="token assign-left variable">uid</span><span class="token operator">=</span>prueba,ou<span class="token operator">=</span>Personas,dc<span class="token operator">=</span>antonio,dc<span class="token operator">=</span>gonzalonazareno,dc<span class="token operator">=</span>org</pre></td></tr><tr><td data-num="2"></td><td><pre>objectClass: posixAccount</pre></td></tr><tr><td data-num="3"></td><td><pre>objectClass: inetOrgPerson</pre></td></tr><tr><td data-num="4"></td><td><pre>objectClass: <span class="token function">top</span></pre></td></tr><tr><td data-num="5"></td><td><pre>cn: prueba</pre></td></tr><tr><td data-num="6"></td><td><pre>gidNumber: <span class="token number">2001</span></pre></td></tr><tr><td data-num="7"></td><td><pre>homeDirectory: /home/prueba</pre></td></tr><tr><td data-num="8"></td><td><pre>loginShell: /bin/bash</pre></td></tr><tr><td data-num="9"></td><td><pre>sn: prueba</pre></td></tr><tr><td data-num="10"></td><td><pre>uid: prueba</pre></td></tr><tr><td data-num="11"></td><td><pre>uidNumber: <span class="token number">2001</span></pre></td></tr><tr><td data-num="12"></td><td><pre>userPassword: <span class="token punctuation">&#123;</span>SSHA<span class="token punctuation">&#125;</span>sfqp8j+/1HHe7N6qcbDIrLkf3T2c4wIW</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>dn: <span class="token assign-left variable">uid</span><span class="token operator">=</span>macarena,ou<span class="token operator">=</span>Personas,dc<span class="token operator">=</span>antonio,dc<span class="token operator">=</span>gonzalonazareno,dc<span class="token operator">=</span>org</pre></td></tr><tr><td data-num="15"></td><td><pre>objectClass: posixAccount</pre></td></tr><tr><td data-num="16"></td><td><pre>objectClass: inetOrgPerson</pre></td></tr><tr><td data-num="17"></td><td><pre>objectClass: <span class="token function">top</span></pre></td></tr><tr><td data-num="18"></td><td><pre>cn: macarena</pre></td></tr><tr><td data-num="19"></td><td><pre>gidNumber: <span class="token number">2002</span></pre></td></tr><tr><td data-num="20"></td><td><pre>homeDirectory: /home/macarena</pre></td></tr><tr><td data-num="21"></td><td><pre>loginShell: /bin/bash</pre></td></tr><tr><td data-num="22"></td><td><pre>sn: macarena</pre></td></tr><tr><td data-num="23"></td><td><pre>uid: macarena</pre></td></tr><tr><td data-num="24"></td><td><pre>uidNumber: <span class="token number">2002</span></pre></td></tr><tr><td data-num="25"></td><td><pre>userPassword: <span class="token punctuation">&#123;</span>SSHA<span class="token punctuation">&#125;</span>sCwMT7CqCloD4bzvED/1QB9xvUnZ0N5P</pre></td></tr></table></figure><p>Para los hash de contraseñas la hemos creado con la utilidad slappasswd, que viene instalada con slapd.</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>root@alfa:/home/antonio<span class="token comment"># slappasswd</span></pre></td></tr><tr><td data-num="2"></td><td><pre>New password: </pre></td></tr><tr><td data-num="3"></td><td><pre>Re-enter new password: </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#123;</span>SSHA<span class="token punctuation">&#125;</span>sfqp8j+/1HHe7N6qcbDIrLkf3T2c4wIW</pre></td></tr></table></figure><p>Para agregar al usuario prueba y al usuario macarena debemos de volver a inyectar el fichero Usuario.ldif en el árbol de slapd, para ello ejecutamos el siguiente comando:</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>ldapadd <span class="token parameter variable">-x</span> <span class="token parameter variable">-D</span> <span class="token string">"cn=admin,dc=antonio,dc=gonzalonazareno,dc=org"</span> <span class="token parameter variable">-f</span> usuarios.ldif <span class="token parameter variable">-W</span></pre></td></tr></table></figure><p><img src="/images/slap1-4.png" alt="Descripción de la imagen"></p>
<p>Lo que hemos hecho ha sido insertar registros en el objeto de personas, ahora vamos a crear un grupo, para ello crearemos un fichero llamado grupos.ldif, y le daremos el siguiente contenido:</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>dn: <span class="token assign-left variable">cn</span><span class="token operator">=</span>desarrollo,ou<span class="token operator">=</span>Grupos,dc<span class="token operator">=</span>antonio,dc<span class="token operator">=</span>gonzalonazareno,dc<span class="token operator">=</span>org</pre></td></tr><tr><td data-num="2"></td><td><pre>objectClass: <span class="token function">top</span></pre></td></tr><tr><td data-num="3"></td><td><pre>objectClass: groupOfNames</pre></td></tr><tr><td data-num="4"></td><td><pre>cn: desarrollo</pre></td></tr><tr><td data-num="5"></td><td><pre>member:</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>dn: <span class="token assign-left variable">cn</span><span class="token operator">=</span>sistemas,ou<span class="token operator">=</span>Grupos,dc<span class="token operator">=</span>antonio,dc<span class="token operator">=</span>gonzalonazareno,dc<span class="token operator">=</span>org</pre></td></tr><tr><td data-num="8"></td><td><pre>objectClass: <span class="token function">top</span></pre></td></tr><tr><td data-num="9"></td><td><pre>objectClass: groupOfNames</pre></td></tr><tr><td data-num="10"></td><td><pre>cn: sistemas</pre></td></tr><tr><td data-num="11"></td><td><pre>member:</pre></td></tr></table></figure><p>A continuación vamos a inyectar el fichero grupos.ldif en el árbol de slapd, para ello ejecutamos el siguiente comando:</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>ldapadd <span class="token parameter variable">-x</span> <span class="token parameter variable">-D</span> <span class="token string">"cn=admin,dc=antonio,dc=gonzalonazareno,dc=org"</span> <span class="token parameter variable">-f</span> grupos.ldif <span class="token parameter variable">-W</span></pre></td></tr></table></figure><p><img src="/images/slap1-5.png" alt="Descripción de la imagen"></p>
<p>Luego vamos a añadir a los usuarios a los grupos, para ello crearemos un fichero llamado personas-grupos.ldif, y le daremos el siguiente contenido:</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># Al grupo de desarrollo</span></pre></td></tr><tr><td data-num="2"></td><td><pre>dn: <span class="token assign-left variable">cn</span><span class="token operator">=</span>desarrollo,ou<span class="token operator">=</span>Grupos,dc<span class="token operator">=</span>antonio,dc<span class="token operator">=</span>gonzalonazareno,dc<span class="token operator">=</span>org</pre></td></tr><tr><td data-num="3"></td><td><pre>changetype:modify</pre></td></tr><tr><td data-num="4"></td><td><pre>add: member</pre></td></tr><tr><td data-num="5"></td><td><pre>member: <span class="token assign-left variable">uid</span><span class="token operator">=</span>prueba,ou<span class="token operator">=</span>Personas,dc<span class="token operator">=</span>antonio,dc<span class="token operator">=</span>gonzalonazareno,dc<span class="token operator">=</span>org</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># Al grupo de desarrollo y sistemas</span></pre></td></tr><tr><td data-num="8"></td><td><pre>dn: <span class="token assign-left variable">cn</span><span class="token operator">=</span>desarrollo,ou<span class="token operator">=</span>Grupos,dc<span class="token operator">=</span>antonio,dc<span class="token operator">=</span>gonzalonazareno,dc<span class="token operator">=</span>org</pre></td></tr><tr><td data-num="9"></td><td><pre>changetype:modify</pre></td></tr><tr><td data-num="10"></td><td><pre>add: member</pre></td></tr><tr><td data-num="11"></td><td><pre>member: <span class="token assign-left variable">uid</span><span class="token operator">=</span>macarena,ou<span class="token operator">=</span>Personas,dc<span class="token operator">=</span>antonio,dc<span class="token operator">=</span>gonzalonazareno,dc<span class="token operator">=</span>org</pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>dn: <span class="token assign-left variable">cn</span><span class="token operator">=</span>sistemas,ou<span class="token operator">=</span>Grupos,dc<span class="token operator">=</span>antonio,dc<span class="token operator">=</span>gonzalonazareno,dc<span class="token operator">=</span>org</pre></td></tr><tr><td data-num="14"></td><td><pre>changetype:modify</pre></td></tr><tr><td data-num="15"></td><td><pre>add: member</pre></td></tr><tr><td data-num="16"></td><td><pre>member: <span class="token assign-left variable">uid</span><span class="token operator">=</span>macarena,ou<span class="token operator">=</span>Personas,dc<span class="token operator">=</span>antonio,dc<span class="token operator">=</span>gonzalonazareno,dc<span class="token operator">=</span>org</pre></td></tr></table></figure><p>A continuación vamos a inyectar el fichero personas-grupos.ldif en el árbol de slapd, para ello ejecutamos el siguiente comando:</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>ldapmodify <span class="token parameter variable">-x</span> <span class="token parameter variable">-D</span> <span class="token string">"cn=admin,dc=antonio,dc=gonzalonazareno,dc=org"</span> <span class="token parameter variable">-f</span> personas-grupos.ldif <span class="token parameter variable">-W</span></pre></td></tr></table></figure><p><img src="/images/slap1-6.png" alt="Descripción de la imagen"></p>
<p>Podríamos usar también ldapmodify que es una herramiente enfocada a la modificación, pero para nuestro caso ambas nos sirven.</p>
<p>Usando el comando ldapsearch podemos ver que los usuarios están en los grupos:</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>ldapsearch <span class="token parameter variable">-x</span> <span class="token parameter variable">-D</span> <span class="token string">"cn=admin,dc=antonio,dc=gonzalonazareno,dc=org"</span> <span class="token parameter variable">-b</span> <span class="token string">"cn=desarrollo,ou=Grupos,dc=antonio,dc=gonzalonazareno,dc=org"</span> <span class="token parameter variable">-W</span></pre></td></tr></table></figure><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>root@alfa:/home/antonio<span class="token comment"># ldapsearch -x -b ou=Grupos,dc=antonio,dc=gonzalonazareno,dc=org</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># extended LDIF</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">#</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># LDAPv3</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># base &lt;ou=Grupos,dc=antonio,dc=gonzalonazareno,dc=org> with scope subtree</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># filter: (objectclass=*)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># requesting: ALL</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">#</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment"># Grupos, antonio.gonzalonazareno.org</span></pre></td></tr><tr><td data-num="11"></td><td><pre>dn: <span class="token assign-left variable">ou</span><span class="token operator">=</span>Grupos,dc<span class="token operator">=</span>antonio,dc<span class="token operator">=</span>gonzalonazareno,dc<span class="token operator">=</span>org</pre></td></tr><tr><td data-num="12"></td><td><pre>objectClass: organizationalUnit</pre></td></tr><tr><td data-num="13"></td><td><pre>ou: Grupos</pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment"># sistemas, Grupos, antonio.gonzalonazareno.org</span></pre></td></tr><tr><td data-num="16"></td><td><pre>dn: <span class="token assign-left variable">cn</span><span class="token operator">=</span>sistemas,ou<span class="token operator">=</span>Grupos,dc<span class="token operator">=</span>antonio,dc<span class="token operator">=</span>gonzalonazareno,dc<span class="token operator">=</span>org</pre></td></tr><tr><td data-num="17"></td><td><pre>objectClass: <span class="token function">top</span></pre></td></tr><tr><td data-num="18"></td><td><pre>objectClass: groupOfNames</pre></td></tr><tr><td data-num="19"></td><td><pre>cn: sistemas</pre></td></tr><tr><td data-num="20"></td><td><pre>member:</pre></td></tr><tr><td data-num="21"></td><td><pre>member: <span class="token assign-left variable">uid</span><span class="token operator">=</span>macarena,ou<span class="token operator">=</span>Personas,dc<span class="token operator">=</span>antonio,dc<span class="token operator">=</span>gonzalonazareno,dc<span class="token operator">=</span>org</pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token comment"># desarrollo, Grupos, antonio.gonzalonazareno.org</span></pre></td></tr><tr><td data-num="24"></td><td><pre>dn: <span class="token assign-left variable">cn</span><span class="token operator">=</span>desarrollo,ou<span class="token operator">=</span>Grupos,dc<span class="token operator">=</span>antonio,dc<span class="token operator">=</span>gonzalonazareno,dc<span class="token operator">=</span>org</pre></td></tr><tr><td data-num="25"></td><td><pre>objectClass: <span class="token function">top</span></pre></td></tr><tr><td data-num="26"></td><td><pre>objectClass: groupOfNames</pre></td></tr><tr><td data-num="27"></td><td><pre>cn: desarrollo</pre></td></tr><tr><td data-num="28"></td><td><pre>member:</pre></td></tr><tr><td data-num="29"></td><td><pre>member: <span class="token assign-left variable">uid</span><span class="token operator">=</span>prueba,ou<span class="token operator">=</span>Personas,dc<span class="token operator">=</span>antonio,dc<span class="token operator">=</span>gonzalonazareno,dc<span class="token operator">=</span>org</pre></td></tr><tr><td data-num="30"></td><td><pre>member: <span class="token assign-left variable">uid</span><span class="token operator">=</span>macarena,ou<span class="token operator">=</span>Personas,dc<span class="token operator">=</span>antonio,dc<span class="token operator">=</span>gonzalonazareno,dc<span class="token operator">=</span>org</pre></td></tr><tr><td data-num="31"></td><td><pre></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token comment"># search result</span></pre></td></tr><tr><td data-num="33"></td><td><pre>search: <span class="token number">2</span></pre></td></tr><tr><td data-num="34"></td><td><pre>result: <span class="token number">0</span> Success</pre></td></tr><tr><td data-num="35"></td><td><pre></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token comment"># numResponses: 6</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token comment"># numEntries: 5</span></pre></td></tr></table></figure><p>Si queremos borrar un elemento del árbol podemos realizarlo gracias a la siguiente instrucción:</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>ldapdelete <span class="token parameter variable">-x</span> <span class="token parameter variable">-D</span> <span class="token string">'cn=admin,dc=antonio,dc=gonzalonazareno,dc=org'</span> <span class="token parameter variable">-W</span> <span class="token assign-left variable">cn</span><span class="token operator">=</span>reabastecimiento,ou<span class="token operator">=</span>Grupos,dc<span class="token operator">=</span>antonio,dc<span class="token operator">=</span>gonzalonazareno,dc<span class="token operator">=</span>org</pre></td></tr></table></figure><p>Desplegar árbol a través de NFS:</p>
<p>apt-get install nfs-kernel-server -y</p>
<p>Nos vamos a /etc/exportfs y añadimos la siguiente línea:</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>/home/antonio/nfs *<span class="token punctuation">(</span>rw,fsid<span class="token operator">=</span><span class="token number">0</span>,subtree_check,no_root_squash<span class="token punctuation">)</span></pre></td></tr></table></figure><p>Ahora ejecutamos  <code>exportfs -a</code></p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>root@alfa:/home/antonio<span class="token comment"># mkdir nfs</span></pre></td></tr><tr><td data-num="2"></td><td><pre>root@alfa:/home/antonio<span class="token comment"># mkdir nfs/almacenamiento</span></pre></td></tr></table></figure><p>Comenzamos con la configuración del paquete nscd. Este es un demonio de caché para el servicio de nombres, lo cual evitará repetir consultas de las bases de datos de passwd, group y hosts.</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">apt</span> <span class="token function">install</span> libnss-ldapd libpam-ldapd nscd <span class="token parameter variable">-y</span></pre></td></tr></table></figure><p>Luego de configurar el instalador de forma que capture la ip 127.0.0.1 y el nombre dc=antonio,dc=gonzalonazareno,dc=org, debemos editar el fichero /etc/nsswitch.conf, y añadir las siguientes líneas:</p>
<p><img src="/images/slap1-7.png" alt="Descripción de la imagen"></p>
<h2 id="cliente-ubuntu"><a class="markdownIt-Anchor" href="#cliente-ubuntu">#</a> Cliente Ubuntu</h2>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">apt-get</span> <span class="token function">install</span> libnss-ldapd libpam-ldapd nscd nfs-kernel-server <span class="token parameter variable">-y</span></pre></td></tr></table></figure><p>Introducimos la dirección IP del servidor LDAP y el nombre del dominio:</p>
<p><img src="/images/slap1-8.png" alt="Descripción de la imagen"></p>
<p>En el fichero /etc/ldap/ldap.conf se establecen los parámetros de configuración del cliente LDAP. En este fichero se establece la dirección del servidor LDAP, el puerto, el dominio, el tipo de autenticación, etc.</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># LDAP Defaults</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">#</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># See ldap.conf(5) for details</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># This file should be world readable but not world writable.</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>BASE    <span class="token assign-left variable">dc</span><span class="token operator">=</span>antonio,dc<span class="token operator">=</span>gonzalonazareno,dc<span class="token operator">=</span>org</pre></td></tr><tr><td data-num="9"></td><td><pre>URI     ldap://192.168.0.1</pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>SIZELIMIT       <span class="token number">12</span></pre></td></tr><tr><td data-num="12"></td><td><pre>TIMELIMIT       <span class="token number">15</span></pre></td></tr><tr><td data-num="13"></td><td><pre>DEREF           never</pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment"># TLS certificates (needed for GnuTLS)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>TLS_CACERT      /etc/ssl/certs/ca-certificates.crt</pre></td></tr></table></figure><p>Ahora necesitaremos configurar el cliente para que al iniciar sesión cree el home del usuario. Para ello editamos el fichero /etc/pam.d/common-account y añadimos la siguiente línea:</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>session required pam_mkhomedir.so <span class="token assign-left variable">skel</span><span class="token operator">=</span>/etc/skel/ <span class="token assign-left variable">umask</span><span class="token operator">=</span>0022</pre></td></tr></table></figure><p>Vamos a probar montando de manera efímera el directorio en el cual se va a crear el home del usuario macarena:</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">mount</span> <span class="token parameter variable">-t</span> nfs <span class="token number">192.168</span>.0.1:/home/antonio/nfs/ /home</pre></td></tr></table></figure><p>Ahora cuando el usuario macarena inicie sesión este se verá reflejado en nuestro servidor nfs, probaremos creando un documento txt:</p>
<p><img src="/images/slap1-9.png" alt="Descripción de la imagen"></p>
<p>Ahora vamos a hacer que este recurso funcione de manera permanente, para ello podríamos editar el fichero fstab, o bien crear una unidad de systemd, que en este caso es lo que vamos a emplear.</p>
<p>nano /etc/systemd/system/home.mount</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>Unit<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token assign-left variable">Description</span><span class="token operator">=</span> Montaje de carpeta home para NFS</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span>Mount<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token assign-left variable">What</span><span class="token operator">=</span><span class="token number">192.168</span>.0.1:/home/antonio/nfs</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token assign-left variable">Where</span><span class="token operator">=</span>/home   </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token assign-left variable">Type</span><span class="token operator">=</span>nfs</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token assign-left variable">Options</span><span class="token operator">=</span>defaults</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">[</span>Install<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target</pre></td></tr></table></figure><p>systemctl daemon-reload<br>
systemctl enable home.mount<br>
systemctl start home.mount<br>
systemctl status home.mount</p>
<p><img src="/images/slap1-10.png" alt="Descripción de la imagen"></p>
<h2 id="cliente-rocky-linux"><a class="markdownIt-Anchor" href="#cliente-rocky-linux">#</a> Cliente Rocky Linux</h2>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>dnf <span class="token function">install</span> openldap-clients sssd sssd-ldap oddjob-mkhomedir sssd-tools <span class="token parameter variable">-y</span></pre></td></tr></table></figure><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>authselect list</pre></td></tr></table></figure><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@bravo antonio<span class="token punctuation">]</span><span class="token comment"># authselect list</span></pre></td></tr><tr><td data-num="2"></td><td><pre>- minimal	 Local <span class="token function">users</span> only <span class="token keyword">for</span> minimal installations</pre></td></tr><tr><td data-num="3"></td><td><pre>- sssd   	 Enable SSSD <span class="token keyword">for</span> system authentication <span class="token punctuation">(</span>also <span class="token keyword">for</span> <span class="token builtin class-name">local</span> <span class="token function">users</span> only<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>- winbind	 Enable winbind <span class="token keyword">for</span> system authentication</pre></td></tr></table></figure><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>authselect <span class="token keyword">select</span> sssd with-mkhomedir <span class="token parameter variable">--force</span></pre></td></tr></table></figure><p>volvemos a especificar la dirección IP del servidor LDAP y el nombre del dominio en /etc/openldap/ldap.conf:</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>BASE <span class="token assign-left variable">dc</span><span class="token operator">=</span>antonio,dc<span class="token operator">=</span>gonzalonazareno,dc<span class="token operator">=</span>org</pre></td></tr><tr><td data-num="2"></td><td><pre>URI ldap://172.16.0.1</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>SIZELIMIT       <span class="token number">12</span></pre></td></tr><tr><td data-num="6"></td><td><pre>TIMELIMIT       <span class="token number">15</span></pre></td></tr><tr><td data-num="7"></td><td><pre>DEREF           never</pre></td></tr></table></figure><p>sudo nano /etc/sssd/sssd.conf</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>domain/default<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre>id_provider <span class="token operator">=</span> ldap</pre></td></tr><tr><td data-num="3"></td><td><pre>autofs_provider <span class="token operator">=</span> ldap</pre></td></tr><tr><td data-num="4"></td><td><pre>auth_provider <span class="token operator">=</span> ldap</pre></td></tr><tr><td data-num="5"></td><td><pre>chpass_provider <span class="token operator">=</span> ldap</pre></td></tr><tr><td data-num="6"></td><td><pre>ldap_uri <span class="token operator">=</span> ldap://172.0.16.1</pre></td></tr><tr><td data-num="7"></td><td><pre>ldap_search_base <span class="token operator">=</span> <span class="token assign-left variable">dc</span><span class="token operator">=</span>antonio,dc<span class="token operator">=</span>gonzalonazareno,dc<span class="token operator">=</span>org</pre></td></tr><tr><td data-num="8"></td><td><pre>ldap_id_use_start_tls <span class="token operator">=</span> True</pre></td></tr><tr><td data-num="9"></td><td><pre>ldap_tls_cacertdir <span class="token operator">=</span> /etc/openldap/cacerts</pre></td></tr><tr><td data-num="10"></td><td><pre>cache_credentials <span class="token operator">=</span> True</pre></td></tr><tr><td data-num="11"></td><td><pre>ldap_tls_reqcert <span class="token operator">=</span> allow</pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">[</span>sssd<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="14"></td><td><pre>services <span class="token operator">=</span> nss, pam, autofs</pre></td></tr><tr><td data-num="15"></td><td><pre>domains <span class="token operator">=</span> default</pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">[</span>nss<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="18"></td><td><pre>homedir_substring <span class="token operator">=</span> /home/nfs</pre></td></tr></table></figure><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">chmod</span> 0600 /etc/sssd/sssd.conf</pre></td></tr><tr><td data-num="2"></td><td><pre>systemctl restart sssd</pre></td></tr></table></figure><p>authconfig --enablemkhomedir --updateall</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>authconfig <span class="token parameter variable">--enableldap</span> <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token parameter variable">--enableldapauth</span> <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token parameter variable">--ldapserver</span><span class="token operator">=</span>antonio.gonzalonazareno.org <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token parameter variable">--ldapbasedn</span><span class="token operator">=</span><span class="token string">"dc=antonio,dc=gonzalonazareno,dc=org"</span> <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token parameter variable">--enablemkhomedir</span> <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token parameter variable">--update</span></pre></td></tr></table></figure><p><img src="/images/slap1-11.png" alt="Descripción de la imagen"></p>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><em></em><a class="button is-default" href="/2023/01/26/vpn-wireguard/" title="VPN Wireguard"><span class="has-text-weight-semibold">Siguiente: VPN Wireguard</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section><article class="mt-6 comment-container"><script async repo="Haojen/Claudia-theme-blog" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/evanticks"><i class="iconfont icon-github"></i></a><!-- Ins--><a title="instagram" target="_blank" rel="noopener nofollow" href="//www.instagram.com//"><i class="iconfont icon-ins"></i></a><!-- RSS--><!-- 知乎--><!-- 领英--><!-- 脸书--></section><p><span>Copyright ©</span><span> Antonio Marchán 2023</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo</p><p class="is-flex is-justify-content-center"></p><div style="margin-top: 2px"></div></div><div><span></span></div></footer><script src="/js/post.js"></script></body></html>